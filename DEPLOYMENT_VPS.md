# دليل النشر على خادم VPS (Moonlight POS)

هذا الدليل يشرح كيفية نشر نظام "نظام النخيل" (Moonlight POS) على خادم VPS باستخدام Docker.

## المتطلبات المسبقة

تأكد من توفر ما يلي على الخادم الخاص بك (VPS):
1.  نظام تشغيل Linux (Ubuntu 20.04/22.04 موصى به).
2.  **Docker** و **Docker Compose** مثبتين.
3.  اسم نطاق (Domain) موجه إلى عنوان IP الخاص بالخادم (اختياري، يمكنك استخدام IP مباشرة).

## خطوات التثبيت السريع

### 1. نقل الملفات إلى الخادم

قم برفع الملفات التالية إلى مجلد جديد على الخادم (مثلاً `/opt/moonlight-pos`):
- `Dockerfile`
- `docker-compose.yml`
- `nginx.conf`
- `package.json`
- `package-lock.json`
- `bun.lockb` (إن وجد)
- `tsconfig.json` (وملفات الـ config الأخرى)
- `vite.config.ts`
- مجلد `src` بالكامل
- مجلد `public` بالكامل
- `index.html`

يمكنك استخدام `scp` أو `git` لنقل الملفات.

### 2. إعداد متغيرات البيئة (هام جداً)

تأكد من أن ملفات الكود تحتوي على مفاتيح Supabase الصحيحة. في تطبيقات React التي تستخدم Vite، عادة ما تكون في ملف `.env` محلياً.

للإنتاج، لديك خياران:
1.  إنشاء ملف `.env` على السيرفر بنفس محتوى ملف `.env` المحلي لديك.
2.  أو تمرير المتغيرات أثناء عملية البناء (Build) في Dockerfile (غير موصى به للأمان العالي ولكن سهل).

**الطريقة الأفضل:**
قم بإنشاء ملف `.env` في نفس المجلد على السيرفر يحتوي على:

```env
VITE_SUPABASE_URL=رابط_مشروعك_هنا
VITE_SUPABASE_ANON_KEY=المفتاح_العام_هنا
```

### 3. التشغيل

افتح التيرمينال في مجلد المشروع على السيرفر ونفذ الأمر التالي:

```bash
docker-compose up -d --build
```

هذا الأمر سيقوم بـ:
1.  بناء نسخة الإنتاج (Build) من تطبيق React.
2.  إنشاء حاوية Nginx خفيفة وسريعة.
3.  تشغيل النظام على المنفذ 80.

## التحقق من العمل

افتح المتصفح واذهب إلى عنوان IP الخاص بالخادم (أو الدومين). يجب أن يظهر شاشة تسجيل الدخول للنظام.

## الأجهزة الطرفية (الطباعة والباركود)

بما أن النظام يعمل الآن كتطبيق ويب (Web App):

### 1. قارئ الباركود (Barcode Scanner)
*   معظم أجهزة قارئ الباركود USB تعمل بوضع "محاكاة لوحة المفاتيح" (Keyboard Emulation).
*   **طريقة الاستخدام:** فقط ضع المؤشر في حقل البحث أو حقل الباركود، وقم بمسح المنتج. سيعمل فوراً دون أي إعدادات إضافية.
*   تأكد من أن لغة الإدخال في جهاز الكمبيوتر هي الإنجليزية لضمان قراءة الأرقام بشكل صحيح.

### 2. طابعة الفواتير (Thermal Printer)
*   يجب تعريف الطابعة على جهاز الكمبيوتر الذي يفتح الموقع (وليس السيرفر).
*   عند الضغط على "طباعة"، سيفتح النظام نافذة الطباعة الخاصة بالمتصفح.
*   **الإعداد لمرة واحدة:** في نافذة الطباعة، اختر طابعة الفواتير، وتأكد من:
    *   **Paper Size:** 80mm (أو حسب حجم طابعتك).
    *   **Margins:** None (أو Minimum).
    *   **Scale:** 100%.
    *   إلغاء خيار "Headers and footers".

## الصيانة والتحديث

لتحديث النظام بعد إجراء تغييرات في الكود:

1.  ارفع الملفات المعدلة للسيرفر.
2.  نفذ الأمر:
    ```bash
    docker-compose up -d --build
    ```

## استكشاف الأخطاء

*   إذا لم يفتح الموقع، تأكد من أن المنفذ 80 مفتوح في جدار الحماية (Firewall/UFW) الخاص بالسيرفر.
*   لعرض سجلات الأخطاء:
    ```bash
    docker-compose logs -f
    ```
